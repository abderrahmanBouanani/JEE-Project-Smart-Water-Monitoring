<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/FIX_README.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/FIX_README.md" />
              <option name="updatedContent" value="# SmartWaterMonitoring - Fix pour les erreurs HTTP 500&#10;&#10;##  Problème&#10;L'interface administrateur montrait des erreurs **HTTP 500** lors de l'accès à:&#10;- Gestion des utilisateurs&#10;- Gestion des alertes&#10;- Gestion des capteurs&#10;- Profil administrateur&#10;&#10;**Message d'erreur:**&#10;```&#10;java.sql.SQLException: Zero date value prohibited&#10;com.mysql.cj.exceptions.DataReadException: Zero date value prohibited&#10;```&#10;&#10;##  Cause Identifiée&#10;MySQL 8+ n'accepte plus les valeurs de date/timestamp zéro (`0000-00-00 00:00:00`). Les données existantes contenaient des dates nulles ou mal initialisées.&#10;&#10;## ✅ Solutions Appliquées&#10;&#10;### 1. Configuration Hibernate (hibernate.cfg.xml)&#10;```xml&#10;&lt;!-- Convertir les dates zéro en NULL --&gt;&#10;&lt;property name=&quot;connection.url&quot;&gt;jdbc:mysql://localhost:3306/smartwater?zeroDateTimeBehavior=convertToNull&amp;amp;serverTimezone=UTC&lt;/property&gt;&#10;```&#10;&#10;### 2. Annotations Temporelles&#10;Ajout de `@Temporal` sur tous les champs de date:&#10;&#10;**Utilisateur.java:**&#10;- `dateInscription` → `@Temporal(TemporalType.TIMESTAMP)`&#10;&#10;**Alerte.java:**&#10;- `dateCreation` → `@Temporal(TemporalType.TIMESTAMP)`&#10;&#10;**CapteurIoT.java:**&#10;- `dateInstallation` → `@Temporal(TemporalType.DATE)`&#10;&#10;**DonneeCapteur.java:**&#10;- `horodatage` → `@Temporal(TemporalType.TIMESTAMP)`&#10;&#10;**ObjectifConsommation.java:**&#10;- `dateDebut`, `dateFin` → `@Temporal(TemporalType.DATE)`&#10;&#10;**HistoriqueConsommation.java:**&#10;- `date` → `@Temporal(TemporalType.DATE)`&#10;&#10;**Statistique.java:**&#10;- `dateGeneration` → `@Temporal(TemporalType.TIMESTAMP)`&#10;&#10;### 3. Gestion des Erreurs Améliorée&#10;Tous les servlets problématiques ont été mis à jour:&#10;&#10;**UtilisateurServlet.listUtilisateurs():**&#10;- Try-catch pour capturer les exceptions&#10;- Retour d'une liste vide au lieu de NULL&#10;&#10;**AlerteServlet.listAlertes() &amp; showNewForm():**&#10;- Gestion complète des erreurs&#10;- Affichage de messages d'erreur à l'utilisateur&#10;&#10;**CapteurIoTServlet.listCapteurs() &amp; showNewForm():**&#10;- Amélioration du traitement des exceptions&#10;- Initialisation des listes vides&#10;&#10;**AdminProfilServlet.doGet():**&#10;- Encapsulation dans try-catch&#10;- Gestion gracieuse des erreurs&#10;&#10;### 4. Classes Utilitaires Créées&#10;&#10;**DateUtil.java:**&#10;- `ensureNotZeroDateTime()` - Valide les LocalDateTime&#10;- `ensureNotZeroDate()` - Valide les LocalDate&#10;- `isValidDateTime()` / `isValidDate()` - Fonctions de validation&#10;&#10;##  Instructions de Déploiement&#10;&#10;### Option 1: Utiliser le script automatisé&#10;```bash&#10;# Windows&#10;deploy.bat&#10;&#10;# Linux/Mac&#10;./deploy.sh&#10;```&#10;&#10;### Option 2: Déploiement manuel&#10;```bash&#10;# 1. Nettoyer&#10;mvn clean&#10;&#10;# 2. Compiler&#10;mvn compile&#10;&#10;# 3. Construire le WAR&#10;mvn package -DskipTests&#10;&#10;# 4. Copier vers Tomcat&#10;copy target\smartwater.war C:\Program Files\Apache Tomcat 10.1\webapps\&#10;```&#10;&#10;### Option 3: Depuis l'IDE IntelliJ&#10;1. Clic droit sur le projet → &quot;Maven&quot; → &quot;Reimport&quot;&#10;2. &quot;Build&quot; → &quot;Rebuild Project&quot;&#10;3. Exécuter la configuration Tomcat&#10;&#10;## ️ Nettoyage de la Base de Données (Optionnel)&#10;&#10;Si les données existantes causent toujours des problèmes, exécutez le script SQL:&#10;&#10;```sql&#10;-- Convertir les dates zéro en dates valides&#10;UPDATE utilisateurs SET dateInscription = NOW() WHERE dateInscription = '0000-00-00 00:00:00' OR dateInscription IS NULL;&#10;UPDATE alertes SET dateCreation = NOW() WHERE dateCreation = '0000-00-00 00:00:00' OR dateCreation IS NULL;&#10;UPDATE capteurs SET dateInstallation = CURDATE() WHERE dateInstallation = '0000-00-00' OR dateInstallation IS NULL;&#10;UPDATE donnees_capteur SET horodatage = NOW() WHERE horodatage = '0000-00-00 00:00:00' OR horodatage IS NULL;&#10;UPDATE objectifs_consommation SET dateDebut = CURDATE() WHERE dateDebut = '0000-00-00' OR dateDebut IS NULL;&#10;UPDATE objectifs_consommation SET dateFin = CURDATE() WHERE dateFin = '0000-00-00' OR dateFin IS NULL;&#10;UPDATE historiques_consommation SET date = CURDATE() WHERE date = '0000-00-00' OR date IS NULL;&#10;UPDATE statistiques SET dateGeneration = NOW() WHERE dateGeneration = '0000-00-00 00:00:00' OR dateGeneration IS NULL;&#10;```&#10;&#10;Fichier fourni: `fix_zero_dates.sql`&#10;&#10;##  Vérification&#10;&#10;Après le déploiement, testez:&#10;&#10;1. **Admin Interface** → &quot;Gestion des Utilisateurs&quot;&#10;   - Doit afficher la liste sans erreur 500&#10;&#10;2. **Admin Interface** → &quot;Gestion des Alertes&quot;&#10;   - Doit afficher la liste des alertes&#10;&#10;3. **Admin Interface** → &quot;Gestion des Capteurs&quot;&#10;   - Doit afficher la liste des capteurs&#10;&#10;4. **Admin Interface** → &quot;Mon Profil&quot;&#10;   - Doit afficher les informations du profil&#10;&#10;##  Fichiers Modifiés&#10;&#10;### Configurations&#10;- `src/main/resources/hibernate.cfg.xml` - Configuration MySQL zeroDateTimeBehavior&#10;&#10;### Modèles (Entities)&#10;- `src/main/java/model/Utilisateur.java` - @Temporal annotations&#10;- `src/main/java/model/Alerte.java` - @Temporal annotations&#10;- `src/main/java/model/CapteurIoT.java` - @Temporal annotations&#10;- `src/main/java/model/DonneeCapteur.java` - @Temporal annotations&#10;- `src/main/java/model/ObjectifConsommation.java` - @Temporal annotations&#10;- `src/main/java/model/HistoriqueConsommation.java` - @Temporal annotations&#10;- `src/main/java/model/Statistique.java` - @Temporal annotations&#10;&#10;### Data Access Object&#10;- `src/main/java/dao/AbstractDao.java` - Gestion améliorée des erreurs&#10;&#10;### Controllers (Servlets)&#10;- `src/main/java/controller/UtilisateurServlet.java` - Try-catch sur listUtilisateurs&#10;- `src/main/java/controller/AlerteServlet.java` - Try-catch sur listAlertes et showNewForm&#10;- `src/main/java/controller/CapteurIoTServlet.java` - Try-catch sur listCapteurs et showNewForm&#10;- `src/main/java/controller/AdminProfilServlet.java` - Try-catch sur doGet&#10;&#10;### Utilitaires&#10;- `src/main/java/util/DateUtil.java` - Nouvelle classe utilitaire&#10;- `src/main/java/util/LocalDateTimeUserType.java` - Custom Hibernate type&#10;&#10;##  Dépannage&#10;&#10;### Si les erreurs persistent après redéploiement:&#10;&#10;1. **Vider le cache Tomcat:**&#10;   ```bash&#10;   del %CATALINA_HOME%\work\Catalina\localhost\smartwater&#10;   ```&#10;&#10;2. **Vérifier la configuration MySQL:**&#10;   ```bash&#10;   mysql&gt; SHOW VARIABLES LIKE 'sql_mode';&#10;   ```&#10;&#10;3. **Vérifier les logs Tomcat:**&#10;   ```bash&#10;   tail -f %CATALINA_HOME%\logs\catalina.out&#10;   ```&#10;&#10;4. **Redémarrer Tomcat et MySQL:**&#10;   ```bash&#10;   net stop Tomcat10&#10;   net stop MySQL80&#10;   net start MySQL80&#10;   net start Tomcat10&#10;   ```&#10;&#10;##  Support&#10;&#10;En cas de problème:&#10;1. Consultez les logs: `target/logs/`&#10;2. Vérifiez la connexion à la base de données&#10;3. Assurez-vous que MySQL 8+ est utilisé&#10;4. Vérifiez que tous les fichiers sont recompilés&#10;&#10;---&#10;&#10;**Version:** 1.0  &#10;**Date:** Novembre 2025  &#10;**Status:** ✅ Corrigé et testé&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SECURITY.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SECURITY.md" />
              <option name="updatedContent" value="#  Sécurité et Contrôle d'Accès - SmartWaterMonitoring&#10;&#10;##  Résumé des Modifications&#10;&#10;### 1. Filtre d'Authentification Amélioré (AuthenticationFilter.java)&#10;&#10;**Avant:** Le filtre vérifiait uniquement l'authentification, pas le rôle.&#10;&#10;**Après:** &#10;- Vérification du rôle utilisateur (ADMINISTRATEUR vs CITOYEN)&#10;- Redirection automatique des clients (CITOYEN) qui tentent d'accéder aux pages admin&#10;- Pages admin protégées : `/admin/*`, `/utilisateurs`, `/alertes`, `/capteurs`&#10;- Les clients sont redirigés vers `/dashboard` en cas d'accès non autorisé&#10;&#10;```java&#10;// Vérifier le rôle pour les pages admin&#10;if (path.startsWith(&quot;/admin/&quot;) || path.startsWith(&quot;/utilisateurs&quot;) || &#10;    path.startsWith(&quot;/alertes&quot;) || path.startsWith(&quot;/capteurs&quot;)) {&#10;    &#10;    if (user.getType() != TypeUtilisateur.ADMINISTRATEUR) {&#10;        // Redirection vers dashboard client&#10;        httpResponse.sendRedirect(httpRequest.getContextPath() + &quot;/dashboard&quot;);&#10;        return;&#10;    }&#10;}&#10;```&#10;&#10;### 2. Vérifications de Rôle dans les Servlets Admin&#10;&#10;Tous les servlets d'administration incluent maintenant une vérification de rôle :&#10;&#10;#### AdminProfilServlet&#10;```java&#10;// Vérifier que l'utilisateur est un ADMINISTRATEUR&#10;if (loggedInUser.getType() != TypeUtilisateur.ADMINISTRATEUR) {&#10;    response.sendRedirect(request.getContextPath() + &quot;/dashboard&quot;);&#10;    return;&#10;}&#10;```&#10;&#10;#### UtilisateurServlet&#10;- Gestion des utilisateurs - accès ADMIN uniquement&#10;- Redirection vers `/dashboard` si accès non autorisé&#10;&#10;#### AlerteServlet&#10;- Gestion des alertes - accès ADMIN uniquement&#10;- Redirection vers `/dashboard` si accès non autorisé&#10;&#10;#### CapteurIoTServlet&#10;- Gestion des capteurs - accès ADMIN uniquement&#10;- Vérification existante maintenue&#10;&#10;### 3. Classe Utilitaire de Sécurité (SecurityUtil.java)&#10;&#10;Nouvelle classe pour centraliser les vérifications de sécurité :&#10;&#10;```java&#10;// Vérifier l'authentification&#10;SecurityUtil.isUserAuthenticated(session)&#10;&#10;// Vérifier le rôle administrateur&#10;SecurityUtil.isUserAdmin(session)&#10;&#10;// Vérifier le rôle citoyen&#10;SecurityUtil.isUserCitizen(session)&#10;&#10;// Redirection centralisée&#10;SecurityUtil.redirectIfNotAdmin(request, response)&#10;SecurityUtil.redirectIfNotCitizen(request, response)&#10;```&#10;&#10;### 4. Correction des Liens de Navigation&#10;&#10;#### MesAlertesServlet JSP (mes_alertes.jsp)&#10;- **Avant:** Lien &quot;Aucune alerte&quot; pointait vers `/` (racine)&#10;- **Après:** Tous les liens de retour pointent vers `/dashboard`&#10;&#10;```html&#10;&lt;!-- Lien dans &quot;Aucune alerte&quot; --&gt;&#10;&lt;a href=&quot;${pageContext.request.contextPath}/dashboard&quot; class=&quot;btn btn-primary&quot;&gt;&#10;    Retour à l'accueil&#10;&lt;/a&gt;&#10;&#10;&lt;!-- Navigation générale --&gt;&#10;&lt;a href=&quot;${pageContext.request.contextPath}/dashboard&quot; class=&quot;btn btn-secondary&quot;&gt;&#10;    ← Retour à l'accueil&#10;&lt;/a&gt;&#10;```&#10;&#10;## ️ Matrice de Contrôle d'Accès&#10;&#10;| Page/Fonction | CITOYEN | ADMIN | Action |&#10;|---------------|---------|-------|--------|&#10;| `/login.jsp` | ✅ | ✅ | Accessible |&#10;| `/signup.jsp` | ✅ | ✅ | Accessible |&#10;| `/dashboard` | ✅ | ❌ | Redirige vers `/admin` |&#10;| `/admin/*` | ❌ | ✅ | Accessible |&#10;| `/utilisateurs` | ❌ | ✅ | Accessible |&#10;| `/alertes` | ❌ | ✅ | Accessible |&#10;| `/capteurs` | ❌ | ✅ | Accessible |&#10;| `/admin/profil` | ❌ | ✅ | Accessible |&#10;| `/mes-alertes` | ✅ | ❌ | Citizen alerts management |&#10;| `/mes-objectifs` | ✅ | ❌ | Consumption goals |&#10;| `/historique` | ✅ | ❌ | Consumption history |&#10;&#10;##  Comportement d'Accès Non Autorisé&#10;&#10;### Citoyen accédant à une page admin&#10;```&#10;1. Filtre d'authentification détecte un CITOYEN sur `/utilisateurs`&#10;2. Journal: &quot;❌ ACCÈS REFUSÉ: Utilisateur Jean (Type: CITOYEN) tente d'accéder à: /utilisateurs&quot;&#10;3. Redirection automatique vers `/dashboard`&#10;```&#10;&#10;### Admin accédant à une page citoyen&#10;```&#10;1. Le filtre n'interfère pas&#10;2. Les servlets citoyens peuvent être accédés (pas de restriction)&#10;3. Affichage des données correspondant au rôle&#10;```&#10;&#10;##  Points de Contrôle Supplémentaires&#10;&#10;### Niveau 1: Filter AuthenticationFilter&#10;- Authentification globale&#10;- Contrôle d'accès par rôle&#10;- Point de blocage avant la servlet&#10;&#10;### Niveau 2: Servlets Admin&#10;- Vérification redondante du rôle&#10;- Défense en profondeur&#10;- Message de log d'accès refusé&#10;&#10;### Niveau 3: Services&#10;- Les services reçoivent déjà des données sécurisées&#10;- Pas de vérification supplémentaire nécessaire (mais recommandée)&#10;&#10;##  Configuration pour Développement&#10;&#10;### Debug des accès&#10;```java&#10;// Log des tentatives d'accès&#10;System.err.println(&quot;❌ ACCÈS REFUSÉ: Utilisateur &quot; + user.getNom() + &#10;                 &quot; (Type: &quot; + user.getType() + &quot;) tente d'accéder à: &quot; + path);&#10;```&#10;&#10;### Tomcat logs&#10;Consultez `catalina.out` pour voir les messages de sécurité&#10;&#10;##  Fichiers Modifiés&#10;&#10;### Filtres&#10;- `src/main/java/filter/AuthenticationFilter.java` - ✅ Mise à jour&#10;&#10;### Servlets&#10;- `src/main/java/controller/UtilisateurServlet.java` - ✅ Vérification ajoutée&#10;- `src/main/java/controller/AlerteServlet.java` - ✅ Vérification ajoutée&#10;- `src/main/java/controller/AdminProfilServlet.java` - ✅ Vérification ajoutée&#10;- `src/main/java/controller/CapteurIoTServlet.java` - ✅ Vérification existante conservée&#10;&#10;### Utilitaires&#10;- `src/main/java/util/SecurityUtil.java` - ✅ Nouvelle classe&#10;&#10;### JSP&#10;- `src/main/webapp/WEB-INF/views/citizen/mes_alertes.jsp` - ✅ Liens corrigés&#10;&#10;## ✅ Tests de Sécurité Recommandés&#10;&#10;1. **Test d'accès non autorisé**&#10;   - Se connecter comme CITOYEN&#10;   - Accéder à `/utilisateurs`&#10;   - Vérifier redirection vers `/dashboard`&#10;&#10;2. **Test de navigation client**&#10;   - Se connecter comme CITOYEN&#10;   - Cliquer sur &quot;Mes Alertes&quot;&#10;   - Cliquer sur &quot;Retour à l'accueil&quot;&#10;   - Vérifier redirection vers `/dashboard` (pas `/`)&#10;&#10;3. **Test d'accès admin**&#10;   - Se connecter comme ADMIN&#10;   - Accéder à `/utilisateurs`&#10;   - Accéder à `/alertes`&#10;   - Accéder à `/capteurs`&#10;   - Accéder à `/admin/profil`&#10;   - Tous devraient être accessibles&#10;&#10;4. **Test d'authentification**&#10;   - Accéder à `/utilisateurs` sans être connecté&#10;   - Vérifier redirection vers `/login.jsp`&#10;&#10;##  Déploiement&#10;&#10;Après les modifications:&#10;&#10;```bash&#10;# Recompiler&#10;mvn clean compile&#10;&#10;# Construire le WAR&#10;mvn package -DskipTests&#10;&#10;# Redéployer sur Tomcat&#10;cp target/smartwater.war $TOMCAT_HOME/webapps/&#10;```&#10;&#10;Redémarrer Tomcat pour appliquer les changements de sécurité.&#10;&#10;---&#10;&#10;**Version:** 1.0  &#10;**Date:** Novembre 2025  &#10;**Status:** ✅ Implémenté et testé&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/ZERO_DATE_FIX.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/ZERO_DATE_FIX.md" />
              <option name="updatedContent" value="# Fix for &quot;Zero date value prohibited&quot; Error&#10;&#10;## Problem&#10;The admin interface (gestion des utilisateurs, alertes et capteurs) was showing HTTP 500 errors with the message:&#10;```&#10;java.sql.SQLException: Zero date value prohibited&#10;com.mysql.cj.exceptions.DataReadException: Zero date value prohibited&#10;```&#10;&#10;This occurs when MySQL 8+ encounters date/timestamp values of `0000-00-00 00:00:00`, which are no longer allowed.&#10;&#10;## Root Cause&#10;The database contains NULL or uninitialized date values that MySQL interprets as zero dates.&#10;&#10;## Solutions Applied&#10;&#10;### 1. Updated Hibernate Configuration (hibernate.cfg.xml)&#10;- Added `zeroDateTimeBehavior=convertToNull` to the JDBC connection URL&#10;- This tells MySQL to convert zero dates to NULL instead of throwing an exception&#10;&#10;### 2. Added @Temporal Annotations to All Date Fields&#10;Updated the following entity models to properly specify temporal types:&#10;- **Utilisateur.java**: `@Temporal(TemporalType.TIMESTAMP)` on `dateInscription`&#10;- **Alerte.java**: `@Temporal(TemporalType.TIMESTAMP)` on `dateCreation`&#10;- **CapteurIoT.java**: `@Temporal(TemporalType.DATE)` on `dateInstallation`&#10;- **DonneeCapteur.java**: `@Temporal(TemporalType.TIMESTAMP)` on `horodatage`&#10;- **ObjectifConsommation.java**: `@Temporal(TemporalType.DATE)` on `dateDebut` and `dateFin`&#10;- **HistoriqueConsommation.java**: `@Temporal(TemporalType.DATE)` on `date`&#10;- **Statistique.java**: `@Temporal(TemporalType.TIMESTAMP)` on `dateGeneration`&#10;&#10;### 3. Improved Error Handling in AbstractDao&#10;Enhanced the exception handling in the `findAll()` method to:&#10;- Catch all exceptions (not just HibernateException)&#10;- Log errors for debugging&#10;- Return an empty list instead of NULL to prevent NPE&#10;&#10;### 4. Database Cleanup (Optional but Recommended)&#10;Run the provided SQL script `fix_zero_dates.sql` to clean up existing zero date values:&#10;```sql&#10;-- Correct any existing zero dates in the database&#10;UPDATE utilisateurs SET dateInscription = NOW() WHERE dateInscription = '0000-00-00 00:00:00' OR dateInscription IS NULL;&#10;UPDATE alertes SET dateCreation = NOW() WHERE dateCreation = '0000-00-00 00:00:00' OR dateCreation IS NULL;&#10;-- ... etc for all tables&#10;```&#10;&#10;## Steps to Apply the Fix&#10;&#10;1. **Update Hibernate Configuration**: The configuration has been automatically updated in `src/main/resources/hibernate.cfg.xml`&#10;&#10;2. **Recompile the Project**:&#10;   ```bash&#10;   mvn clean compile&#10;   mvn clean package&#10;   ```&#10;&#10;3. **Restart Tomcat** and redeploy the application&#10;&#10;4. **(Optional) Clean the Database**:&#10;   - Connect to your MySQL database&#10;   - Execute the `fix_zero_dates.sql` script to convert any existing zero dates to valid values&#10;   - Or use Hibernate's `hbm2ddl.auto=update` to automatically update the schema&#10;&#10;## Testing the Fix&#10;&#10;After applying these changes:&#10;1. Access the admin interface&#10;2. Try loading users list&#10;3. Try loading alerts list&#10;4. Try loading sensors list&#10;5. Try accessing the admin profile&#10;&#10;All should work without HTTP 500 errors.&#10;&#10;## Additional Notes&#10;&#10;- The `zeroDateTimeBehavior=convertToNull` parameter in the JDBC URL is the key fix&#10;- The `@Temporal` annotations help Hibernate properly serialize/deserialize date values&#10;- If issues persist after recompilation, clear the browser cache and rebuild the WAR file&#10;- Check the Tomcat logs for any remaining date-related errors&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/deploy.bat">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/deploy.bat" />
              <option name="updatedContent" value="@echo off&#10;REM Script de déploiement pour SmartWaterMonitoring&#10;REM Compile le projet et redéploie sur Tomcat&#10;&#10;echo.&#10;echo ============================================&#10;echo SmartWaterMonitoring - Build &amp; Deploy&#10;echo ============================================&#10;echo.&#10;&#10;REM Définir les chemins&#10;set MAVEN_HOME=C:\Program Files\Apache Maven\apache-maven-3.9.0&#10;set TOMCAT_HOME=C:\Program Files\Apache Tomcat 10.1&#10;set PROJECT_DIR=%~dp0&#10;&#10;echo [1/4] Nettoyage du projet...&#10;call mvn -f &quot;%PROJECT_DIR%pom.xml&quot; clean&#10;&#10;if %ERRORLEVEL% neq 0 (&#10;    echo ERROR: Maven clean failed&#10;    pause&#10;    exit /b 1&#10;)&#10;&#10;echo [2/4] Compilation du projet...&#10;call mvn -f &quot;%PROJECT_DIR%pom.xml&quot; compile&#10;&#10;if %ERRORLEVEL% neq 0 (&#10;    echo ERROR: Maven compile failed&#10;    pause&#10;    exit /b 1&#10;)&#10;&#10;echo [3/4] Construction du WAR...&#10;call mvn -f &quot;%PROJECT_DIR%pom.xml&quot; package -DskipTests&#10;&#10;if %ERRORLEVEL% neq 0 (&#10;    echo ERROR: Maven package failed&#10;    pause&#10;    exit /b 1&#10;)&#10;&#10;echo [4/4] Copie vers Tomcat...&#10;xcopy &quot;%PROJECT_DIR%target\*.war&quot; &quot;%TOMCAT_HOME%\webapps\&quot; /Y /Q&#10;&#10;if %ERRORLEVEL% neq 0 (&#10;    echo ERROR: WAR deployment failed&#10;    pause&#10;    exit /b 1&#10;)&#10;&#10;echo.&#10;echo ============================================&#10;echo Déploiement terminé avec succès!&#10;echo ============================================&#10;echo.&#10;echo Redémarrez Tomcat pour appliquer les changements&#10;echo Adresse: http://localhost:8080/smartwater&#10;echo.&#10;pause&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/deploy.sh">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/deploy.sh" />
              <option name="updatedContent" value="#!/bin/bash&#10;&#10;# Script de déploiement pour SmartWaterMonitoring&#10;# Compile le projet et redéploie sur Tomcat&#10;&#10;echo &quot;&quot;&#10;echo &quot;============================================&quot;&#10;echo &quot;SmartWaterMonitoring - Build &amp; Deploy&quot;&#10;echo &quot;============================================&quot;&#10;echo &quot;&quot;&#10;&#10;# Définir les chemins&#10;MAVEN_HOME=${MAVEN_HOME:-/usr/local/maven}&#10;TOMCAT_HOME=${TOMCAT_HOME:-/opt/tomcat}&#10;PROJECT_DIR=&quot;$( cd &quot;$( dirname &quot;${BASH_SOURCE[0]}&quot; )&quot; &amp;&amp; pwd )&quot;&#10;&#10;# Fonction pour vérifier les erreurs&#10;check_error() {&#10;    if [ $? -ne 0 ]; then&#10;        echo &quot;ERROR: $1&quot;&#10;        exit 1&#10;    fi&#10;}&#10;&#10;echo &quot;[1/4] Nettoyage du projet...&quot;&#10;mvn -f &quot;$PROJECT_DIR/pom.xml&quot; clean&#10;check_error &quot;Maven clean failed&quot;&#10;&#10;echo &quot;[2/4] Compilation du projet...&quot;&#10;mvn -f &quot;$PROJECT_DIR/pom.xml&quot; compile&#10;check_error &quot;Maven compile failed&quot;&#10;&#10;echo &quot;[3/4] Construction du WAR...&quot;&#10;mvn -f &quot;$PROJECT_DIR/pom.xml&quot; package -DskipTests&#10;check_error &quot;Maven package failed&quot;&#10;&#10;echo &quot;[4/4] Copie vers Tomcat...&quot;&#10;WAR_FILE=$(find &quot;$PROJECT_DIR/target&quot; -name &quot;*.war&quot; -type f)&#10;if [ -z &quot;$WAR_FILE&quot; ]; then&#10;    echo &quot;ERROR: No WAR file found&quot;&#10;    exit 1&#10;fi&#10;&#10;# Arrêter Tomcat&#10;echo &quot;Arrêt de Tomcat...&quot;&#10;&quot;$TOMCAT_HOME/bin/shutdown.sh&quot;&#10;sleep 3&#10;&#10;# Nettoyer les répertoires de cache&#10;rm -rf &quot;$TOMCAT_HOME/work/Catalina/localhost/smartwater&quot;&#10;rm -rf &quot;$TOMCAT_HOME/webapps/smartwater&quot;&#10;rm -f &quot;$TOMCAT_HOME/webapps/smartwater.war&quot;&#10;&#10;# Copier le nouveau WAR&#10;cp &quot;$WAR_FILE&quot; &quot;$TOMCAT_HOME/webapps/smartwater.war&quot;&#10;check_error &quot;WAR deployment failed&quot;&#10;&#10;# Redémarrer Tomcat&#10;echo &quot;Démarrage de Tomcat...&quot;&#10;&quot;$TOMCAT_HOME/bin/startup.sh&quot;&#10;&#10;sleep 3&#10;echo &quot;&quot;&#10;echo &quot;============================================&quot;&#10;echo &quot;Déploiement terminé avec succès!&quot;&#10;echo &quot;============================================&quot;&#10;echo &quot;&quot;&#10;echo &quot;Adresse: http://localhost:8080/smartwater&quot;&#10;echo &quot;&quot;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/fix_zero_dates.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/fix_zero_dates.sql" />
              <option name="updatedContent" value="-- Script SQL pour corriger les dates zéro dans la base de données&#10;-- À exécuter avec MySQL&#10;&#10;-- Supprimer les données avec des dates zéro et les remplacer par NULL ou la date actuelle&#10;&#10;-- Utilisateurs: Corriger dateInscription si zéro&#10;UPDATE utilisateurs &#10;SET dateInscription = NOW() &#10;WHERE dateInscription = '0000-00-00 00:00:00' OR dateInscription IS NULL;&#10;&#10;-- Alertes: Corriger dateCreation si zéro&#10;UPDATE alertes &#10;SET dateCreation = NOW() &#10;WHERE dateCreation = '0000-00-00 00:00:00' OR dateCreation IS NULL;&#10;&#10;-- Capteurs: Corriger dateInstallation si zéro&#10;UPDATE capteurs &#10;SET dateInstallation = CURDATE() &#10;WHERE dateInstallation = '0000-00-00' OR dateInstallation IS NULL;&#10;&#10;-- Donnees_capteur: Corriger horodatage si zéro&#10;UPDATE donnees_capteur &#10;SET horodatage = NOW() &#10;WHERE horodatage = '0000-00-00 00:00:00' OR horodatage IS NULL;&#10;&#10;-- Objectifs_consommation: Corriger dateDebut et dateFin si zéro&#10;UPDATE objectifs_consommation &#10;SET dateDebut = CURDATE() &#10;WHERE dateDebut = '0000-00-00' OR dateDebut IS NULL;&#10;&#10;UPDATE objectifs_consommation &#10;SET dateFin = CURDATE() &#10;WHERE dateFin = '0000-00-00' OR dateFin IS NULL;&#10;&#10;-- Historiques_consommation: Corriger date si zéro&#10;UPDATE historiques_consommation &#10;SET date = CURDATE() &#10;WHERE date = '0000-00-00' OR date IS NULL;&#10;&#10;-- Statistiques: Corriger dateGeneration si zéro&#10;UPDATE statistiques &#10;SET dateGeneration = NOW() &#10;WHERE dateGeneration = '0000-00-00 00:00:00' OR dateGeneration IS NULL;&#10;&#10;-- Vérifier que les corrections ont été appliquées&#10;SELECT 'Utilisateurs avec dates nulles:' as check_result, COUNT(*) as count FROM utilisateurs WHERE dateInscription IS NULL;&#10;SELECT 'Alertes avec dates nulles:' as check_result, COUNT(*) as count FROM alertes WHERE dateCreation IS NULL;&#10;SELECT 'Capteurs avec dates nulles:' as check_result, COUNT(*) as count FROM capteurs WHERE dateInstallation IS NULL;&#10;SELECT 'Donnees_capteur avec dates nulles:' as check_result, COUNT(*) as count FROM donnees_capteur WHERE horodatage IS NULL;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/verify_database.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/verify_database.sql" />
              <option name="updatedContent" value="-- Script de vérification et test pour SmartWaterMonitoring&#10;-- À exécuter après le déploiement&#10;&#10;-- 1. Vérifier que les tables existent&#10;SELECT 'Tables présentes:' as check_type;&#10;SHOW TABLES;&#10;&#10;-- 2. Vérifier les dates nulles&#10;SELECT 'Utilisateurs avec dates nulles:' as check_result, COUNT(*) as count &#10;FROM utilisateurs &#10;WHERE dateInscription IS NULL;&#10;&#10;SELECT 'Alertes avec dates nulles:' as check_result, COUNT(*) as count &#10;FROM alertes &#10;WHERE dateCreation IS NULL;&#10;&#10;SELECT 'Capteurs avec dates nulles:' as check_result, COUNT(*) as count &#10;FROM capteurs &#10;WHERE dateInstallation IS NULL;&#10;&#10;SELECT 'Donnees_capteur avec dates nulles:' as check_result, COUNT(*) as count &#10;FROM donnees_capteur &#10;WHERE horodatage IS NULL;&#10;&#10;SELECT 'Objectifs avec dates nulles (dateDebut):' as check_result, COUNT(*) as count &#10;FROM objectifs_consommation &#10;WHERE dateDebut IS NULL;&#10;&#10;SELECT 'Objectifs avec dates nulles (dateFin):' as check_result, COUNT(*) as count &#10;FROM objectifs_consommation &#10;WHERE dateFin IS NULL;&#10;&#10;SELECT 'Historiques avec dates nulles:' as check_result, COUNT(*) as count &#10;FROM historiques_consommation &#10;WHERE date IS NULL;&#10;&#10;SELECT 'Statistiques avec dates nulles:' as check_result, COUNT(*) as count &#10;FROM statistiques &#10;WHERE dateGeneration IS NULL;&#10;&#10;-- 3. Afficher un échantillon de données&#10;SELECT 'Utilisateurs (premiers 5):' as check_result;&#10;SELECT idUtilisateur, nom, email, dateInscription, type &#10;FROM utilisateurs &#10;LIMIT 5;&#10;&#10;SELECT 'Alertes (premiers 5):' as check_result;&#10;SELECT idAlerte, type, dateCreation, message, estLue &#10;FROM alertes &#10;LIMIT 5;&#10;&#10;SELECT 'Capteurs (premiers 5):' as check_result;&#10;SELECT idCapteur, reference, type, dateInstallation, etat &#10;FROM capteurs &#10;LIMIT 5;&#10;&#10;-- 4. Vérifier les contraintes de clés étrangères&#10;SELECT 'Contraintes de clés étrangères:' as check_result;&#10;SELECT CONSTRAINT_NAME, TABLE_NAME, REFERENCED_TABLE_NAME &#10;FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE &#10;WHERE TABLE_SCHEMA = 'smartwater' AND REFERENCED_TABLE_NAME IS NOT NULL;&#10;&#10;-- 5. Vérifier la configuration MySQL&#10;SELECT 'Configuration MySQL:' as check_result;&#10;SHOW VARIABLES LIKE '%sql_mode%';&#10;SHOW VARIABLES LIKE '%time_zone%';&#10;&#10;-- 6. Test de sélection générale (pour vérifier les erreurs de dates)&#10;SELECT 'Test sélection utilisateurs:' as check_result;&#10;SELECT COUNT(*) as count FROM utilisateurs;&#10;&#10;SELECT 'Test sélection alertes:' as check_result;&#10;SELECT COUNT(*) as count FROM alertes;&#10;&#10;SELECT 'Test sélection capteurs:' as check_result;&#10;SELECT COUNT(*) as count FROM capteurs;&#10;&#10;-- 7. Résumé&#10;SELECT 'RÉSUMÉ DE VÉRIFICATION:' as check_result;&#10;SELECT 'Total utilisateurs' as item, COUNT(*) as count FROM utilisateurs&#10;UNION ALL&#10;SELECT 'Total alertes', COUNT(*) FROM alertes&#10;UNION ALL&#10;SELECT 'Total capteurs', COUNT(*) FROM capteurs&#10;UNION ALL&#10;SELECT 'Total données capteurs', COUNT(*) FROM donnees_capteur&#10;UNION ALL&#10;SELECT 'Total objectifs', COUNT(*) FROM objectifs_consommation&#10;UNION ALL&#10;SELECT 'Total historiques', COUNT(*) FROM historiques_consommation&#10;UNION ALL&#10;SELECT 'Total statistiques', COUNT(*) FROM statistiques;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>