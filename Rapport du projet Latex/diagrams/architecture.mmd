graph TB
    subgraph Client["üñ•Ô∏è Couche Pr√©sentation (Client)"]
        Browser["Navigateur Web"]
        JSP["Pages JSP<br/>login.jsp, dashboard.jsp"]
        Assets["Assets Statiques<br/>CSS, JS, Images"]
    end

    subgraph Web["üåê Couche Pr√©sentation (Serveur)"]
        AuthS["AuthServlet<br/>/auth"]
        UserS["UtilisateurServlet<br/>/utilisateurs"]
        DataAPI["DataApiServlet<br/>/api/waterdata"]
        AlertS["AlerteServlet<br/>/alertes"]
        DashS["DashboardServlet<br/>/dashboard"]
        Filter["AuthenticationFilter<br/>Contr√¥le acc√®s"]
    end

    subgraph Business["‚öôÔ∏è Couche M√©tier"]
        UtilSrv["UtilisateurService"]
        DataSrv["DonneeCapteurService"]
        AlertSrv["AlerteService"]
        AggSrv["DataAggregationService"]
        SecurityUtil["SecurityUtil<br/>BCrypt"]
        Job["DailyAggregationJob<br/>Scheduler"]
    end

    subgraph Data["üíæ Couche Donn√©es"]
        UtilDAO["UtilisateurDAO"]
        CaptDAO["CapteurIoTDAO"]
        DataDAO["DonneeCapteurDAO"]
        AlertDAO["AlerteDAO"]
        HistDAO["HistoriqueConsDAO"]
        StatDAO["StatistiqueDAO"]
        AbstractDAO["AbstractDAO&lt;T&gt;<br/>Base g√©n√©rique"]
    end

    subgraph DB["üóÑÔ∏è Base de Donn√©es"]
        MySQL["MySQL 8.0.33"]
        Utilisateurs["utilisateurs"]
        Capteurs["capteurs"]
        Donnees["donnees_capteurs"]
        Alertes["alertes"]
        Historique["historique_consommation"]
        Statistiques["statistiques"]
        Objectifs["objectifs_consommation"]
    end

    subgraph External["üîå Syst√®mes Externes"]
        IoT["Simulateur IoT<br/>Python"]
        Emails["Service Email"]
    end

    subgraph ORM["üîó ORM & Mapping"]
        Hibernate["Hibernate 6.4.4<br/>SessionFactory"]
    end

    %% Connexions Client-Web
    Browser -->|HTTP/HTTPS| JSP
    Browser -->|GET/POST| AuthS
    Browser -->|GET/POST| UserS
    Browser -->|GET/POST| DashS
    JSP -->|Assets| Assets

    %% Connexions Servlets
    AuthS --> Filter
    UserS --> Filter
    DataAPI --> Filter
    AlertS --> Filter
    DashS --> Filter

    %% Connexions Servlets-Services
    AuthS --> UtilSrv
    UserS --> UtilSrv
    DataAPI --> DataSrv
    AlertS --> AlertSrv
    DashS --> UtilSrv
    DataSrv --> AlertSrv
    DataSrv --> SecurityUtil

    %% Job Scheduler
    Job --> AggSrv
    AggSrv --> DataSrv
    AggSrv --> AlertSrv

    %% Connexions Services-DAOs
    UtilSrv --> UtilDAO
    DataSrv --> DataDAO
    DataSrv --> CaptDAO
    AlertSrv --> AlertDAO
    AggSrv --> HistDAO
    AggSrv --> StatDAO

    %% Connexions DAOs-AbstractDAO
    UtilDAO --> AbstractDAO
    CaptDAO --> AbstractDAO
    DataDAO --> AbstractDAO
    AlertDAO --> AbstractDAO
    HistDAO --> AbstractDAO
    StatDAO --> AbstractDAO

    %% Connexions AbstractDAO-Hibernate
    AbstractDAO --> Hibernate

    %% Connexions Hibernate-BD
    Hibernate --> MySQL

    %% Tables MySQL
    MySQL --> Utilisateurs
    MySQL --> Capteurs
    MySQL --> Donnees
    MySQL --> Alertes
    MySQL --> Historique
    MySQL --> Statistiques
    MySQL --> Objectifs

    %% Syst√®mes externes
    IoT -->|POST JSON| DataAPI
    AlertSrv -->|Envoyer| Emails

    %% Style
    classDef presentation fill:#4A90E2,stroke:#2E5C8A,color:#fff,stroke-width:2px
    classDef business fill:#7ED321,stroke:#5A9A1A,color:#fff,stroke-width:2px
    classDef data fill:#F5A623,stroke:#C67E1A,color:#fff,stroke-width:2px
    classDef database fill:#E94B3C,stroke:#B83A2E,color:#fff,stroke-width:2px
    classDef external fill:#9013FE,stroke:#6B0BD9,color:#fff,stroke-width:2px

    class Client,Web,AuthS,UserS,DataAPI,AlertS,DashS,Filter,Browser,JSP,Assets presentation
    class Business,UtilSrv,DataSrv,AlertSrv,AggSrv,SecurityUtil,Job business
    class Data,AbstractDAO,UtilDAO,CaptDAO,DataDAO,AlertDAO,HistDAO,StatDAO,ORM,Hibernate data
    class DB,MySQL,Utilisateurs,Capteurs,Donnees,Alertes,Historique,Statistiques,Objectifs database
    class External,IoT,Emails external
